# Toronto Money Flow
## Data Schemas (Current JSON Outputs)

Version: 1.2  
Date: January 2026

This file documents the current JSON outputs generated by the ETL scripts and the API response shapes used by the app.

---

## 1. ETL Output Schemas

### 1.1 capital_by_ward.json

```json
[
  {
    "fiscal_year": 2024,
    "ward_number": 11,
    "ward_name": "University-Rosedale",
    "amount": 42300000,
    "year_offset": 1,
    "program_name": "Water Infrastructure",
    "project_name": "Watermain Replacement",
    "category": "State of Good Repair",
    "source_file": "capital-budget-2024.xlsx",
    "source_url": "https://...",
    "ingested_at": "2024-12-26T10:30:00Z"
  }
]
```

Notes:
- Amounts are in dollars (source is in $000s).
- `ward_number = 0` indicates city-wide projects.
- Per-year processed files (`data/processed/capital-by-ward/{year}.json`) use the same schema and include planned future years from the 10-year plan (planned allocations, not final actuals).

### 1.2 financial_return.json

```json
[
  {
    "fiscal_year": 2024,
    "flow_type": "revenue",
    "label": "Taxation - Property",
    "line_description": "Taxation - Property (PIL)",
    "amount": 5200000000,
    "source_files": ["fir-2024.xlsx"],
    "source_resource_ids": ["abc123"],
    "source_resource_names": ["FIR 2024"],
    "source_package_id": "734d5877-f4de-4322-9851-882d22e1a11f",
    "ingested_at": "2024-12-26T10:30:00Z"
  }
]
```

Per-year processed files (`data/processed/financial-return/{year}.json`) use the same schema.

### 1.3 council_voting.json

```json
[
  {
    "meeting_date": "2024-11-15",
    "motion_id": "CC24.15",
    "motion_title": "Traffic Calming Implementation",
    "agenda_item_title": "Traffic Calming Implementation",
    "vote_description": "Majority required - Adopt the item",
    "motion_category": "transportation",
    "vote_outcome": "passed",
    "yes_votes": 20,
    "no_votes": 5,
    "absent_votes": 0,
    "vote_margin": 15,
    "votes": [
      {
        "councillor_name": "Jane Doe",
        "vote": "Yes"
      }
    ],
    "source_resource_id": "55ead013...",
    "ingested_at": "2024-12-26T10:30:00Z"
  }
]
```

Per-year processed files (`data/processed/council-voting/{year}.json`) use the same schema.
Additional fields:
- `agenda_item_title` and `vote_description` are included when available (used by motion detail queries).

### 1.4 lobbyist_activity.json

```json
[
  {
    "registration_date": "2024-10-01",
    "lobbyist_name": "John Doe",
    "lobbyist_type": "Consultant",
    "client_name": "ABC Corporation",
    "subject_matter": "Rezoning for mixed-use development",
    "subject_category": "housing_development",
    "communication_date": "2024-11-15",
    "public_office_holder": "Jane Smith, Councillor",
    "source_resource_id": "94c1fe59...",
    "ingested_at": "2024-12-26T10:30:00Z"
  }
]
```

Per-year processed files (`data/processed/lobbyist-registry/{year}.json`) use the same schema. Year is derived from `communication_date` with `registration_date` as fallback.

### 1.5 gold/council-decisions/summary.json (rolling)

```json
{
  "recent_decisions": [
    {
      "meeting_date": "2024-12-15",
      "motion_id": "MM4.1",
      "motion_title": "Climate Action Funding",
      "motion_category": "environment",
      "vote_outcome": "passed",
      "yes_votes": 20,
      "no_votes": 5,
      "absent_votes": 0,
      "vote_margin_percent": "80.0"
    }
  ],
  "decision_categories": [
    {
      "category": "environment",
      "label": "Environment & Climate",
      "total_motions": 12,
      "passed": 10,
      "failed": 2,
      "pass_rate": 83.3
    }
  ],
  "councillor_voting_patterns": [
    {
      "councillor_name": "Jane Doe",
      "votes_cast": 45,
      "yes_votes": 38,
      "no_votes": 5,
      "absent": 2,
      "participation_rate": 95.6
    }
  ],
  "lobbying_summary": {
    "active_registrations": 234,
    "recent_communications": 45,
    "top_subjects": ["housing_development", "transportation", "environment"]
  },
  "metadata": {
    "year": 2024,
    "recent_days": 365,
    "total_motions": 12,
    "motions_passed": 10,
    "motions_failed": 2,
    "pass_rate": "83.3",
    "meeting_count": 6
  },
  "timestamp": "2024-12-26T10:30:00Z"
}
```

### 1.6 gold/council-decisions/{year}.json

```json
{
  "recent_decisions": [
    {
      "meeting_date": "2024-12-15",
      "motion_id": "MM4.1",
      "motion_title": "Climate Action Funding",
      "motion_category": "environment",
      "vote_outcome": "passed",
      "yes_votes": 20,
      "no_votes": 5,
      "absent_votes": 0,
      "vote_margin_percent": "80.0"
    }
  ],
  "decision_categories": [
    {
      "category": "environment",
      "label": "Environment & Climate",
      "total_motions": 12,
      "passed": 10,
      "failed": 2,
      "pass_rate": 83.3
    }
  ],
  "councillor_voting_patterns": [
    {
      "councillor_name": "Jane Doe",
      "votes_cast": 45,
      "yes_votes": 38,
      "no_votes": 5,
      "absent": 2,
      "participation_rate": 95.6
    }
  ],
  "lobbying_summary": {
    "active_registrations": 234,
    "recent_communications": 45,
    "top_subjects": ["housing_development", "transportation", "environment"]
  },
  "metadata": {
    "year": 2024,
    "total_motions": 12,
    "motions_passed": 10,
    "motions_failed": 2,
    "pass_rate": "83.3",
    "meeting_count": 6,
    "period_start": "2024-01-01",
    "period_end": "2024-12-31"
  },
  "timestamp": "2024-12-26T10:30:00Z"
}
```

### 1.7 ward_boundaries.geojson

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "AREA_SHORT_CODE": "07",
        "AREA_NAME": "Humber River-Black Creek"
      },
      "geometry": {
        "type": "Polygon",
        "coordinates": [[[lng, lat], ...]]
      }
    }
  ]
}
```

### 1.8 gold index files (money-flow, capital, council)

```json
{
  "availableYears": [2020, 2021, 2022, 2023, 2024],
  "latestYear": 2024,
  "files": {
    "2020": "https://storage.googleapis.com/standardize-journalism-data/gold/money-flow/2020.json",
    "2021": "https://storage.googleapis.com/standardize-journalism-data/gold/money-flow/2021.json"
  },
  "timestamp": "2024-12-26T10:30:00Z"
}
```

### 1.9 gold trends files (money-flow, capital, council)

```json
{
  "years": [2020, 2021, 2022, 2023, 2024],
  "latestYear": 2024,
  "totalByYear": {
    "2020": 1200000000,
    "2021": 1250000000
  },
  "categories": [
    {
      "name": "transportation",
      "total": 3000000000,
      "byYear": {
        "2020": 700000000,
        "2021": 750000000
      }
    }
  ],
  "wards": [
    {
      "ward_number": 10,
      "ward_name": "Spadina-Fort York",
      "total": 900000000,
      "byYear": {
        "2020": 200000000,
        "2021": 230000000
      }
    }
  ],
  "timestamp": "2024-12-26T10:30:00Z"
}
```

Council trends (`data/gold/council-decisions/trends.json`) are compact per-year totals:

```json
{
  "availableYears": [2022, 2023, 2024, 2025],
  "latestYear": 2025,
  "byYear": {
    "2024": {
      "total_motions": 145,
      "motions_passed": 113,
      "motions_failed": 19,
      "pass_rate": "77.9",
      "meeting_count": 71
    }
  },
  "timestamp": "2025-12-30T07:49:08Z"
}
```

---

## 2. API Response Schemas

### 2.1 /api/metric

```json
{
  "year": 2024,
  "competitive": {
    "totalValue": 123456789,
    "contractCount": 1234,
    "recordsFetched": 100000,
    "recordsUsed": 5000,
    "topVendors": [
      { "name": "Vendor A", "totalValue": 12300000, "count": 55 }
    ],
    "divisionBreakdown": [
      { "name": "Division A", "totalValue": 15000000, "count": 120 }
    ],
    "categoryBreakdown": [
      { "name": "Category A", "totalValue": 9000000, "count": 80 }
    ],
    "medianAwardSize": 45000,
    "top1VendorShare": 12.3,
    "top10VendorShare": 54.2
  },
  "nonCompetitive": {
    "totalValue": 4567890,
    "contractCount": 120,
    "recordsFetched": 50000,
    "recordsUsed": 800,
    "amountShare": 8.2,
    "countShare": 9.7
  },
  "timestamp": "2024-12-26T10:30:00Z"
}
```

### 2.2 /api/capital-by-ward

```json
{
  "year": 2024,
  "totalInvestment": 123456789,
  "wardSpecificInvestment": 95000000,
  "cityWideInvestment": 28456789,
  "wardCount": 25,
  "cityWideProjectCount": 42,
  "topWards": [
    { "ward_number": 1, "ward_name": "Ward 1", "totalAmount": 12000000, "projectCount": 12, "topCategory": "Transportation" }
  ],
  "bottomWards": [
    { "ward_number": 25, "ward_name": "Ward 25", "totalAmount": 200000, "projectCount": 2, "topCategory": "Parks" }
  ],
  "allWards": [
    { "ward_number": 1, "ward_name": "Ward 1", "totalAmount": 12000000, "projectCount": 12, "topCategory": "Transportation" }
  ],
  "categoryBreakdown": [
    { "name": "Transportation", "totalAmount": 35000000, "projectCount": 40 }
  ],
  "topProjects": [
    { "project_name": "Project A", "ward_name": "Ward 1", "ward_number": 1, "program_name": "Program X", "category": "Transportation", "amount": 5000000 }
  ],
  "governance": {
    "top1WardShare": 15.4,
    "top5WardShare": 46.2,
    "disparityRatio": 120.5
  },
  "timestamp": "2024-12-26T10:30:00Z"
}
```

### 2.3 /api/money-flow

```json
{
  "year": 2024,
  "availableYears": [2020, 2021, 2022, 2023, 2024],
  "revenue": {
    "total": 10800000000,
    "lineItemTotal": 10800000000,
    "reportedTotal": 18200000000,
    "topGroups": [
      { "label": "Property Taxes", "amount": 5200000000, "percentage": 48.1 }
    ],
    "bottomGroups": [
      { "label": "Other", "amount": 120000000, "percentage": 1.1 }
    ]
  },
  "expenditure": {
    "total": 10700000000,
    "lineItemTotal": 10700000000,
    "reportedTotal": 16186000000,
    "topGroups": [
      { "label": "Transportation", "amount": 3800000000, "percentage": 35.5 }
    ],
    "bottomGroups": [
      { "label": "Other", "amount": 90000000, "percentage": 0.8 }
    ]
  },
  "balance": {
    "amount": 100000000,
    "isSurplus": true,
    "percentageOfRevenue": 0.9,
    "reported": {
      "amount": 2016000000,
      "isSurplus": true,
      "percentageOfRevenue": 11.1
    }
  },
  "timestamp": "2024-12-26T10:30:00Z"
}
```

Notes:
- `total`/`lineItemTotal` are sums of filtered line items (summary/rollup rows removed).
- `reportedTotal` and `balance.reported` come from FIR summary lines (PLUS: Total Revenues / LESS: Total Expenses) when available.

### 2.4 /api/council-decisions

```json
{
  "recent_decisions": [
    {
      "meeting_date": "2024-12-15",
      "motion_id": "MM4.1",
      "motion_title": "Climate Action Funding",
      "motion_category": "environment",
      "vote_outcome": "passed",
      "yes_votes": 20,
      "no_votes": 5,
      "absent_votes": 0,
      "vote_margin_percent": "80.0"
    }
  ],
  "decision_categories": [
    {
      "category": "environment",
      "label": "Environment & Climate",
      "total_motions": 12,
      "passed": 10,
      "failed": 2,
      "pass_rate": 83.3
    }
  ],
  "councillor_voting_patterns": [
    {
      "councillor_name": "Jane Doe",
      "votes_cast": 45,
      "yes_votes": 38,
      "no_votes": 5,
      "absent": 2,
      "participation_rate": 95.6
    }
  ],
  "lobbying_summary": {
    "active_registrations": 234,
    "recent_communications": 45,
    "top_subjects": ["housing_development", "transportation", "environment"]
  },
  "metadata": {
    "year": 2024,
    "recent_days": 90,
    "total_motions": 12,
    "motions_passed": 10,
    "motions_failed": 2,
    "pass_rate": "83.3"
  },
  "timestamp": "2024-12-26T10:30:00Z"
}
```

### 2.5 /api/ward-map

```json
{
  "type": "FeatureCollection",
  "features": [
    {
      "type": "Feature",
      "properties": {
        "ward_number": 7,
        "ward_name": "Humber River-Black Creek",
        "total_investment": 12000000,
        "project_count": 12
      },
      "geometry": { "type": "Polygon", "coordinates": [[[lng, lat], ...]] }
    }
  ],
  "metadata": {
    "year": 2024,
    "maxInvestment": 80000000,
    "wardCount": 25
  }
}
```

### 2.6 /api/chat

```json
{
  "answer": "Total capital plan allocation for Ward 10 in 2024 was $71.1M.",
  "response": {
    "schemaVersion": 1,
    "responseType": "metric_sum",
    "summary": "Total capital plan allocation for Ward 10 in 2024 was $71.1M.",
    "structured": {
      "value": 71100000,
      "currency": "CAD",
      "valueType": "planned",
      "years": [2024],
      "dataset": "capital",
      "groupBy": "ward",
      "ward": 10,
      "filters": { "ward": 10 }
    },
    "completeness": "complete",
    "sources": [
      {
        "type": "Capital (gold trends)",
        "dataset": "capital",
        "layer": "gold",
        "path": "https://storage.googleapis.com/standardize-journalism-data/gold/capital/trends.json"
      },
      { "type": "API", "dataset": "capital", "path": "/api/capital-by-ward" }
    ]
  },
  "sources": [
    {
      "type": "Capital (gold trends)",
      "dataset": "capital",
      "layer": "gold",
      "path": "https://storage.googleapis.com/standardize-journalism-data/gold/capital/trends.json"
    },
    { "type": "API", "dataset": "capital", "path": "/api/capital-by-ward" }
  ],
  "metadata": {
    "retrievalType": "tool",
    "tool": "sum_amount",
    "toolDataset": "capital",
    "toolRouting": "llm",
    "toolRoutingConfidence": 0.8,
    "responseType": "metric_sum",
    "completeness": "complete",
    "year": 2024,
    "requestedYear": null,
    "actualYear": 2024,
    "fellBack": false,
    "latestYearChecked": 2025,
    "failureReason": null,
    "failureDetail": null
  }
}
```

Notes:
- `metadata.retrievalType` is `tool` or `rag`. For `rag`, `metadata.ragStrategy` is `filters` or `embeddings`.
- `failureReason`/`failureDetail` are set when a tool or RAG path fails closed.

---

Document version: 1.2
